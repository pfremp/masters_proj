<!DOCTYPE html>
{% extends 'site_base.html' %}

{% load staticfiles %}
{% load bootstrap3 %}
{% load easy_maps_tags %}
{% block extra_head %}
{% endblock %}
{% block title %} {{ experiment }}{% endblock %}

{% block body_block %}

    {% if experiment %}
        <div class="container-fluid">
        <div class="row" style="min-height: 300px;">
            <!-- left column -->
            <div class="col-md-6">
                <h1>{{ experiment.name }}</h1>
                <p><b>{{ experiment.city }}</b></p>
                <br>
                <p>Description:</p>
                <p>{{ experiment.long_description }}</p>
                <br>
                <h2>Apply</h2>
                {%  if user.is_authenticated and user.profile.typex == 'Participant' %}
                    {% if experiment.is_full == True %}
                        <p>Sorry, this experiment is now full</p>
                    {% elif user_applied == True %}
                        <p>{{ Application.experiment.id }}You have already applied to this experiment. VIEW MY EXPERIMENTS {{ experiment.id }} </p>
                    {% else %}
                        <p>Pick a time slot and accept the terms</p>
                        <form id="appform" method="post" action="">
                            {% csrf_token %}
                            {% bootstrap_form appform %}
                            <input class="btn btn-default" type="submit" name="submit" value="Apply" />
                        </form>
                    {% endif %}

                    <!-- Check if user is a reaseacher, researchers cannot apply -->
                {% elif user.profile.typex == 'Researcher'%}
                    <p>You must be a registered participant to apply.</p>
                {% else %}
                    <!-- Ensure that user is logged in to apply. -->
                    <p>Please <a href="/accounts/login">login</a> to apply.</p>
                {% endif %}
            </div>

            <!-- Right column -->
            <div class="col-md-6">
                <!-- Well containing exp information -->
                <div style="margin-top: 20px;">
                    <span class='st_sharethis_large' displayText='ShareThis'></span>
                    <span class='st_facebook_large' displayText='Facebook'></span>
                    <span class='st_twitter_large' displayText='Tweet'></span>
                    <span class='st_email_large' displayText='Email'></span>
                    <span></span>
                </div>

                <!-- right half 2 of page, more info -->
                <div class="panel panel-default">
                    <div class="panel-body">
{#                    <img style="width: 100%;" src="/static/images/gmph.png">#}


                    {% easy_map experiment.address 500 350 using 'part_finder/map.html' %}


                        </div>
                </div>
            </div>
        </div>

        <!-- Bottom half, more details -->
{#        <div class="row">#}
            <div class="panel panel-default">
                <div class="panel-body">
                <!-- left col-->
                <div class="col-md-6">
                    <h4><b>Requirements</b></h4>
                    <p><b>Language(s): </b>{{ lang }}</p>
                    <br>
                    <h4><b>More info</b></h4>
                    <p><b><a href="{% url 'researcher_profile' researcher.userprofile.user.username %}">Researcher Profile</a></b></p>
                    <b>Experiment URL: </b><a href="{{ experiment.url }}">{{ experiment.url }}</a>
                    <br>
                    <br>
                    <h4><b>Address:</b></h4>
                    {{ experiment.address }}
                </div>

                <!-- right col-->
                <div class="col-md-6">
                    <h4><b>Payment</b></h4>
                    <!-- payment info -->
                    {% if payment.is_paid.is_paid == 'Yes' %}
{#                        <table class="table table-responsive">#}
{#                          <caption></caption>#}
{#                          <thead>#}
{#                            <tr>#}
{#                              <th>Type</th>#}
{#                              <th>Amount (£)</th>#}
{#                              <th>Frequency</th>#}
{#                            </tr>#}
{#                          </thead>#}
{#                          <tbody>#}
{#                            <tr>#}
{#                                <td>{{ payment.currency }}</td>#}
{#                                <td>{{ payment.amount }}</td>#}
{#                                <td>{{ payment.payment_type }}</td>#}
{#                            </tr>#}
{#                        </table>#}
                                <p><b>Type:</b> {{ payment.currency }}&nbsp;&nbsp;&nbsp;<b>Amount (£)</b>: {{ payment.amount }}&nbsp;&nbsp;&nbsp;   <b>Frequency</b>: {{ payment.payment_type }}&nbsp;&nbsp;&nbsp;</p>
                    {% else %}
                        <p>N/A</p>
                    {% endif %}


{#                    <p><b>Payment </b></p>#}
{#                    <div class="col-md-3">#}
{#                        {% if experiment.currency == 'Money' %}#}
{#                            <span class="glyphicon glyphicon-gbp" aria-hidden="true"> {{ experiment.payment_amount }} {{ experiment.pmt_type }}</span>#}
{#                        {% else %}#}
{#                            <span>{{ experiment.payment_amount }} Credits</span>#}
{#                        {% endif %}#}
{#                    </div>#}
{##}
{#                    <!-- Duration -->#}
{#                    <div class="col-md-3">#}
{#                        <span class="glyphicon glyphicon-time" aria-hidden="true"> {{ experiment.duration }} Hours</span>#}
{#                    </div>#}
{##}
{#                    <!-- Date info. -->#}
{#                    <div class="col-md-3">#}
{#                        <span class="glyphicon glyphicon-calendar" aria-hidden="true"> {{ experiment.date | date:'M-d' }}</span>#}
{#                    </div>#}
{##}
{#                    <!-- number of participants -->#}
{#                    <div class="col-md-3">#}
{#                        <span class="glyphicon glyphicon-user" aria-hidden="true"> {{ experiment.no_of_participants_wanted }}</span>#}
{#                    </div>#}
                    <br>
                    <h4><b>Timeslots</b></h4>
                    <p><b>Duration:</b> {{ experiment.duration }} hrs</p>
                    {% for t in timeslots %}
                        <p><span class="glyphicon glyphicon-time" aria-hidden="true"></span> <b>{{ t.date }},</b> {{ t.start_time }} - {{ t.end_time }} </p>
                        {% if t.is_full %}
                            <span class="glyphicon glyphicon-user" aria-hidden="true"><b style="color: #f00;"> FULL</b></span>
                            <br>
                            <br>
                        {% else %}
                            <span class="glyphicon glyphicon-user" aria-hidden="true"><b> {{ t.current_parts }} / {{ t.no_of_parts }}</b></span>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
            </div>
{#        </div>#}
    </div>


    {% else %}
        <p>Experiment Not Found</p>
    {% endif %}

{% endblock %}


